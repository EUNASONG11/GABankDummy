<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.projectdummy.loan.LoanMapper">
    <insert id="insLoanLog">
        insert into rate_log
        (loan_id, additional_rate, base_rate, discounted_rate, base_rate_name, use_flag, created_at)
        VALUES
        (#{loanId}, #{additionalRate}, #{baseRate}, #{discountedRate}, #{baseRateName}, #{useFlag}, #{createdAt})
    </insert>

    <select id="selLoan">
        select loan_id
        from loan
        where use_flag = #{useFlag}
    </select>

    <select id="selLoan2">
        select *
        from loan
        where use_flag = #{useFlag}
    </select>
    
    <select id="selLoanInfo">
        SELECT b.account_id, b.created_at, la.end_at , la.loan_money, la.redemption_code
        FROM bank_account b
        JOIN loan l
        ON b.product_id = l.loan_id
        JOIN loan_account la
        ON la.account_id = b.account_id
        WHERE l.rate_flag = 0
    </select>

    <insert id="insLoanRepayment">
        insert into loan_repayment
        (account_id, principal, interest, total_due, due_at, final_at, due_code)
        VALUES
        (#{accountId}, #{principal}, #{interest}, #{totalDue}, #{dueAt}, #{finalAt}, #{dueCode})
    </insert>
</mapper>